kind: Cluster
name: k8s-homelab-cluster
kubernetes:
  version: v1.32.4
talos:
  version: v1.9.6
features:
  diskEncryption: true
  enableWorkloadProxy: true
  useEmbeddedDiscoveryService: true
patches:
  - idOverride: 200-k8s-homelab-cluster
    inline:
      cluster:
        allowSchedulingOnControlPlanes: true
        apiServer:
          admissionControl:
            - name: PodSecurity
              configuration:
                exemptions:
                  namespaces:
                    - rook-ceph
          extraArgs:
            feature-gates: UserNamespacesSupport=true,UserNamespacesPodSecurityStandards=true
        extraManifests:
          - https://raw.githubusercontent.com/dajrivera/k8s-cluster/refs/heads/main/apps/misc/adv-net-conf.yaml
          - https://raw.githubusercontent.com/dajrivera/k8s-cluster/refs/heads/main/apps/cilium/cilium.yaml
        network:
          cni:
            name: none
        proxy:
          disabled: true
      machine:
        kubelet:
          extraArgs:
            max-pods: "250"
          extraConfig:
            featureGates:
              UserNamespacesPodSecurityStandards: true
              UserNamespacesSupport: true
        sysctls:
          user.max_user_namespaces: "11255"
---
kind: ControlPlane
machineClass:
  name: home-cluster
  size: 1
patches:
  - idOverride: 400-talos-default-control-planes
    inline:
      machine:
        install:
          extraKernelArgs:
            - ipv6.disable=1
---
kind: Workers
